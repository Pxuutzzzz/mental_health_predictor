# Nixpacks Configuration for Mental Health Predictor
# Specifies both PHP (for Web UI) and Python (for ML Model)

providers = []

[phases.setup]
# Use APT (Debian) packages
aptPkgs = [
    "php-cli",
    "php-common",
    "php-mysql",
    "php-mbstring",
    "php-curl", 
    "python3",
    "python3-pip",
    "git",
    "unzip",
    "curl"
]

[phases.install]
cmds = [
    # Install Composer manually 
    "curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer",
    
    # Install Python dependencies GLOBALLY (System-wide)
    # This avoids venv being ignored by gitignore or lost during build copy
    "pip3 install -r requirements.txt --break-system-packages",
    
    # Install PHP dependencies
    "cd laravel_web && composer install --no-dev --optimize-autoloader"
]

[start]
# Run PHP directly. Python packages are available globally.
# Use absolute path for PHP for safety.
cmd = "/usr/bin/php -S 0.0.0.0:$PORT -t laravel_web laravel_web/router.php"
