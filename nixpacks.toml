# Nixpacks Configuration for Mental Health Predictor
# Specifies both PHP (for Web UI) and Python (for ML Model)

providers = ["php", "python"]

[phases.setup]
# Explicitly use PHP 8.1 and its extensions to ensure PDO MySQL is available
nixPkgs = [
    "php81",
    "php81Packages.composer",
    "php81Extensions.pdo_mysql",
    "php81Extensions.mbstring",
    "python3",
    "python311Packages.pip"
]

[phases.install]
cmds = [
    "python -m venv /opt/venv && . /opt/venv/bin/activate && pip install -r requirements.txt",
    "cd laravel_web && composer install --no-dev --optimize-autoloader"
]

[start]
cmd = ". /opt/venv/bin/activate && php -S 0.0.0.0:$PORT -t laravel_web laravel_web/router.php"
