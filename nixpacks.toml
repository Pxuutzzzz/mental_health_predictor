# Nixpacks Configuration for Mental Health Predictor
# Specifies both PHP (for Web UI) and Python (for ML Model)

# Clear default providers to rely on explicit APT packages
providers = []

[phases.setup]
# Use APT (Debian) packages to ensure binaries are in standard /usr/bin paths
aptPkgs = [
    "php-cli",
    "php-common",
    "php-mysql",
    "php-mbstring",
    "php-curl", 
    "python3",
    "python3-pip",
    "python3-venv",
    "git",
    "unzip",
    "curl"
]

[phases.install]
cmds = [
    # Install Composer manually 
    "curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer",
    # Setup Python environment in LOCAL directory (safe)
    "python3 -m venv venv",
    ". venv/bin/activate && pip install -r requirements.txt",
    # Install PHP dependencies
    "cd laravel_web && composer install --no-dev --optimize-autoloader"
]

[start]
# Use local venv path
cmd = ". venv/bin/activate && /usr/bin/php -S 0.0.0.0:$PORT -t laravel_web laravel_web/router.php"
